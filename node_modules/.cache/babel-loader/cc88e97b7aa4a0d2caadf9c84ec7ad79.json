{"ast":null,"code":"var _jsxFileName = \"D:\\\\workspace\\\\flyingcarpet\\\\flyingcarpet-shared-inbox\\\\src\\\\pages\\\\apps\\\\Chat\\\\index.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { Row, Col } from 'react-bootstrap';\nimport { API_Key } from '../../../config/index'; // components\n\nimport PageTitle from '../../../components/PageTitle';\nimport ChatUsers from './ChatUsers';\nimport ChatArea from './ChatArea'; // dummy data\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\n// ChatApp\nconst ChatApp = () => {\n  _s();\n\n  const [selectedUser, setSelectedUser] = useState({});\n  const [admin, setadmin] = useState({});\n  const [USER, setUSER] = useState([]); // static users\n\n  const [user, setUser] = useState([]); // dynamic users\n\n  const [unreadNumber, setUnreadnumber] = useState('');\n  /**\r\n   * On user change\r\n   */\n\n  const onUserChange = user => {\n    setSelectedUser(user);\n  };\n\n  useEffect(() => {\n    getMe();\n    getUsers();\n  }, []);\n  useEffect(() => {\n    setSelectedUser(user[0]);\n  }, [user]);\n\n  const getMe = () => {\n    const fetchemailurl = `https://api.chat-api.com/instance${API_Key.instance}/me?token=${API_Key.token}`;\n    fetch(fetchemailurl).then(res => res.json()).then(json => {\n      console.log(json);\n      let user = {\n        id: json.phone,\n        name: json.phone,\n        userStatus: \"online\",\n        avatar: json.photo\n      };\n      setadmin(user);\n    });\n  };\n\n  const getUsers = () => {\n    const fetchemailurl = `https://api.chat-api.com/instance${API_Key.instance}/messages?token=${API_Key.token}`;\n    fetch(fetchemailurl).then(res => res.json()).then(json => {\n      const total = [...json.messages];\n      console.log(total);\n      let userdata = [];\n      let tempdata = [];\n      total.sort((a, b) => b.time - a.time);\n\n      for (let i = 0; i < total.length; i++) {\n        if (tempdata.indexOf(total[i]['chatId']) == -1) {\n          tempdata.push(total[i]['chatId']);\n          let lastMessage;\n\n          if (total[i]['type'] != \"chat\") {\n            lastMessage = \"Attached file\";\n          } else {\n            lastMessage = total[i].body.slice(0, 20);\n          }\n\n          const time = total[i].time;\n          const timedate = new Date(time * 1000);\n          let hour = timedate.getHours();\n          let min = timedate.getMinutes();\n          let tmp = \" AM\";\n\n          if (hour > 12) {\n            hour -= 12;\n            tmp = \" PM\";\n          }\n\n          let user = {\n            id: total[i]['chatName'],\n            avatar: \"\",\n            name: total[i]['senderName'],\n            userStatus: \"online\",\n            lastMessage: lastMessage,\n            lastMessageOn: hour + \":\" + min + tmp,\n            totalUnread: 3\n          };\n\n          if (total[i]['fromMe'] == 1) {\n            user.name = total[i]['chatId'];\n          }\n\n          userdata.push(user);\n        }\n      } //set lastmess\n      // for (let i = 0; i < userdata.length; i++) {\n      //     const temp = [...total.filter((item) => item.fromMe != 1 && item.chatName == userdata[i]['id'])];\n      //     if (temp.length > 0) {\n      //         if (temp[0]['type'] != \"chat\") {\n      //             userdata[i]['lastMessage'] = \"Attached file\";  \n      //         }else{\n      //             userdata[i]['lastMessage'] = temp[0].body;\n      //         }\n      //         const time = temp[0].time;\n      //         console.log(temp[0]);\n      //         const timedate = new Date(time*1000);\n      //         let hour = timedate.getHours();\n      //         let min = timedate.getMinutes();\n      //         let tmp = \" AM\";\n      //         if (hour > 12) {\n      //             hour -= 12;\n      //             tmp = \" PM\";\n      //         }\n      //         userdata[i]['lastMessageOn'] = hour + \":\"+min +tmp;\n      //     }\n      // }\n\n\n      setUSER(userdata);\n      setUser(userdata);\n    });\n  };\n\n  const search = text => {\n    console.log(text);\n    setUser(text ? [...USER].filter(u => u.name.toLowerCase().indexOf(text.toLowerCase()) >= 0) : [...USER]);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(PageTitle, {\n      breadCrumbItems: [// { label: 'Apps', path: '/apps/chat' },\n        // { label: 'Chat', path: '/apps/chat', active: true },\n      ],\n      title: 'Chat'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Row, {\n      children: [/*#__PURE__*/_jsxDEV(Col, {\n        lg: 5,\n        xxl: 3,\n        children: /*#__PURE__*/_jsxDEV(ChatUsers, {\n          admin: admin,\n          user: user,\n          onUserSelect: onUserChange,\n          onSearch: search\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Col, {\n        lg: 7,\n        xxl: 9,\n        children: /*#__PURE__*/_jsxDEV(ChatArea, {\n          selectedUser: selectedUser,\n          setUser: setUser,\n          user: user,\n          admin: admin\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true);\n};\n\n_s(ChatApp, \"7rqxXIYAIq/hD2ifvYsPFOB35Ps=\");\n\n_c = ChatApp;\nexport default ChatApp;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChatApp\");","map":{"version":3,"sources":["D:/workspace/flyingcarpet/flyingcarpet-shared-inbox/src/pages/apps/Chat/index.tsx"],"names":["React","useEffect","useState","Row","Col","API_Key","PageTitle","ChatUsers","ChatArea","ChatApp","selectedUser","setSelectedUser","admin","setadmin","USER","setUSER","user","setUser","unreadNumber","setUnreadnumber","onUserChange","getMe","getUsers","fetchemailurl","instance","token","fetch","then","res","json","console","log","id","phone","name","userStatus","avatar","photo","total","messages","userdata","tempdata","sort","a","b","time","i","length","indexOf","push","lastMessage","body","slice","timedate","Date","hour","getHours","min","getMinutes","tmp","lastMessageOn","totalUnread","search","text","filter","u","toLowerCase"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { Row, Col } from 'react-bootstrap';\r\n\r\nimport { API_Key } from '../../../config/index';\r\n\r\n// components\r\nimport PageTitle from '../../../components/PageTitle';\r\n\r\nimport ChatUsers from './ChatUsers';\r\nimport ChatArea from './ChatArea';\r\n// dummy data\r\nimport { USERS, ChatUserType } from './data';\r\n\r\n// ChatApp\r\nconst ChatApp = () => {\r\n    const [selectedUser, setSelectedUser] = useState<ChatUserType>({});\r\n    const [admin, setadmin] = useState<ChatUserType>({});\r\n    const [USER, setUSER] = useState<ChatUserType[]>([]); // static users\r\n    const [user, setUser] = useState<ChatUserType[]>([]); // dynamic users\r\n    const [unreadNumber, setUnreadnumber] = useState('');\r\n    \r\n    /**\r\n     * On user change\r\n     */\r\n    const onUserChange = (user: ChatUserType) => {\r\n        setSelectedUser(user);\r\n    };\r\n\r\n    useEffect(() => {\r\n        getMe();\r\n        getUsers();\r\n    },[])\r\n\r\n    useEffect(() => {\r\n        setSelectedUser(user[0])\r\n\r\n    },[user])\r\n\r\n    const getMe = () => {\r\n        const fetchemailurl = `https://api.chat-api.com/instance${API_Key.instance}/me?token=${API_Key.token}`;\r\n        fetch(fetchemailurl)\r\n            .then((res) => res.json())\r\n            .then((json) => {\r\n                console.log(json);\r\n                let user : ChatUserType = {\r\n                    id : json.phone,\r\n                    name : json.phone,\r\n                    userStatus : \"online\",\r\n                    avatar : json.photo\r\n                }\r\n                setadmin(user);\r\n            })\r\n    }\r\n\r\n    const getUsers = () => {\r\n        const fetchemailurl = `https://api.chat-api.com/instance${API_Key.instance}/messages?token=${API_Key.token}`;\r\n        fetch(fetchemailurl)\r\n        .then((res)=> res.json())\r\n        .then((json)=>{\r\n            const total = [...json.messages];\r\n            console.log(total);\r\n            let userdata : ChatUserType[] = [];\r\n            let tempdata = [];\r\n            total.sort((a : any, b : any) => b.time - a.time);\r\n            for (let i = 0; i < total.length; i++) {\r\n                if (tempdata.indexOf(total[i]['chatId']) == -1) {\r\n                    tempdata.push(total[i]['chatId']);\r\n                    let lastMessage;\r\n                    if (total[i]['type'] != \"chat\") {\r\n                        lastMessage = \"Attached file\";  \r\n                    }else{\r\n                        lastMessage = total[i].body.slice(0,20);\r\n                    }\r\n                    const time = total[i].time;\r\n                    const timedate = new Date(time*1000);\r\n                    let hour = timedate.getHours();\r\n                    let min = timedate.getMinutes();\r\n                    let tmp = \" AM\";\r\n                    if (hour > 12) {\r\n                        hour -= 12;\r\n                        tmp = \" PM\";\r\n                    }\r\n\r\n                    let user : ChatUserType = {\r\n                        id : total[i]['chatName'],\r\n                        avatar : \"\",\r\n                        name : total[i]['senderName'],\r\n                        userStatus : \"online\",\r\n                        lastMessage : lastMessage,\r\n                        lastMessageOn : hour + \":\"+min +tmp,\r\n                        totalUnread : 3\r\n                    };\r\n                    if (total[i]['fromMe'] == 1) {\r\n                        user.name = total[i]['chatId'];\r\n                    }\r\n                    userdata.push(user)\r\n                }\r\n            }\r\n            //set lastmess\r\n            // for (let i = 0; i < userdata.length; i++) {\r\n            //     const temp = [...total.filter((item) => item.fromMe != 1 && item.chatName == userdata[i]['id'])];\r\n            //     if (temp.length > 0) {\r\n            //         if (temp[0]['type'] != \"chat\") {\r\n            //             userdata[i]['lastMessage'] = \"Attached file\";  \r\n            //         }else{\r\n            //             userdata[i]['lastMessage'] = temp[0].body;\r\n            //         }\r\n            //         const time = temp[0].time;\r\n            //         console.log(temp[0]);\r\n            //         const timedate = new Date(time*1000);\r\n            //         let hour = timedate.getHours();\r\n            //         let min = timedate.getMinutes();\r\n            //         let tmp = \" AM\";\r\n            //         if (hour > 12) {\r\n            //             hour -= 12;\r\n            //             tmp = \" PM\";\r\n            //         }\r\n            //         userdata[i]['lastMessageOn'] = hour + \":\"+min +tmp;\r\n            //     }\r\n            // }\r\n\r\n            setUSER(userdata);\r\n            setUser(userdata);\r\n        })\r\n    }\r\n\r\n    const search = (text: string) => {\r\n        console.log(text);\r\n        setUser(text ? [...USER].filter((u) => u.name!.toLowerCase().indexOf(text.toLowerCase()) >= 0) : [...USER]);\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <PageTitle\r\n                breadCrumbItems={[\r\n                    // { label: 'Apps', path: '/apps/chat' },\r\n                    // { label: 'Chat', path: '/apps/chat', active: true },\r\n                ]}\r\n                title={'Chat'}\r\n            />\r\n\r\n            <Row>\r\n                <Col lg={5} xxl={3}>\r\n                    <ChatUsers admin={admin} user={user} onUserSelect={onUserChange} onSearch = {search}/>\r\n                </Col>\r\n                <Col lg={7} xxl={9}>\r\n                    <ChatArea selectedUser={selectedUser} setUser={setUser} user={user} admin={admin}/>\r\n                </Col>\r\n            </Row>\r\n        </>\r\n    );\r\n};\r\n\r\nexport default ChatApp;\r\n"]},"metadata":{},"sourceType":"module"}